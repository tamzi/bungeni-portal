Notifications
=============

  >>> from bungeni.core.workflows import questionnotification as notification
  >>> from zope.component.interfaces import ObjectEvent

Setup mock delivery component.

  >>> import zope.sendmail.interfaces
  
  >>> class MockMailDelivery(object):
  ...     interface.implements(zope.sendmail.interfaces.IMailDelivery)
  ...
  ...     def send(self, *args):
  ...         print "From: %s\nTo: %s\n\n%s" % args

  >>> component.provideUtility(MockMailDelivery())

Set up a user.

  >>> from bungeni.core.domain import User
  >>> user = User()
  >>> user.first_name = u'John'
  >>> user.last_name = u'Doe'
  >>> user.email = 'john.doe@localhost'
  >>> user.owner_id = 1
  
  >>> from ore.alchemist import Session
  >>> session = Session()
  >>> session.save(user)
  >>> session.flush()
  
Questions
---------

  >>> from bungeni.core.domain import Question
  >>> question = Question()
  >>> question.subject = u"My subject"
  >>> question.owner_id = user.user_id
  >>> question.receive_notification = False
  
Question received.
  
  >>> notification.sendNotificationToMemberUponReceipt(ObjectEvent(question))

Let's change our setting for receive notification so an email message
is dispatched.

  >>> question.receive_notification = True
  >>> notification.sendNotificationToMemberUponReceipt(ObjectEvent(question))
  From: clerks.office@parliament.gov.ke
  To: "John Doe" <john.doe@localhost>...
  Subject: Question received: My subject...
  
Send notification to Clerk's office upon submit.
#XXX
Note that the notification setting for the clerks office are
HARDCODED in the preferences so we cannot test this yet!

    >>> notification.sendNotificationToClerkUponSubmit(ObjectEvent(question))
    From: "John Doe" <john.doe@localhost>
    To: clerks.office@parliament.gov.ke ...
    Subject: Question submitted: My subject ...

  
A question was rejected by the speakers office.
    >>> notification.sendNotificationToMemberUponReject(ObjectEvent(question))
    From: speakers.office@parliament.gov.ke
    To: "John Doe" <john.doe@localhost> ...
    Subject: Question rejected: My subject ...
  

A question needs clarification by the MP
    >>> notification.sendNotificationToMemberUponNeedsClarification(ObjectEvent(question))
    From: clerks.office@parliament.gov.ke
    To: "John Doe" <john.doe@localhost> ...
    Subject: Question needs clarification: My subject ...


A question was deferred by Clerk's office.
    >>> notification.sendNotificationToMemberUponDeferred(ObjectEvent(question))
    From: speakers.office@parliament.gov.ke
    To: "John Doe" <john.doe@localhost> ...
    Subject: Question deferred: My subject ...

A question was scheduled by Speakers office.
    >>> notification.sendNotificationToMemberUponSchedule(ObjectEvent(question))
    From: clerks.office@parliament.gov.ke
    To: "John Doe" <john.doe@localhost> ...
    Subject: Question scheduled: My subject ...

A question was postponed by the speakers office.
    >>> notification.sendNotificationToMemberUponPostponed(ObjectEvent(question))  
    From: clerks.office@parliament.gov.ke
    To: "John Doe" <john.doe@localhost> ...
    Subject: Question postponed: My subject ...
  

A question was sent to a ministry for written response.
    >>> notification.sendNotificationToMemberUponSentToMinistry(ObjectEvent(question))
    From: clerks.office@parliament.gov.ke
    To: "John Doe" <john.doe@localhost> ...
    Subject: Question sent to ministry: My subject ...
  

A questions answer was reviewed by Clerk's office.
    >>> notification.sendNotificationToMemberUponAnswer(ObjectEvent(question))  
    From: clerks.office@parliament.gov.ke
    To: "John Doe" <john.doe@localhost> ...
    Subject: Question answered: My subject ...
  
  
  
