<div class="listing">
  <em> Sittings </em>  
  <table class="listing grid" style="width: 100%;">
    <thead>
      <tr>        
        <!--th colspan="1" tal:content="structure view/previous"> &lt;&lt; </th-->
        <th colspan="8" tal:content="view/monthname"> month </th>
        <!--th colspan="1" tal:content="structure view/next"> &gt;&gt; </th-->
      </tr>
      <tr>        
        <th width="5%">  </th> 
        <!--th width="14%"> Mon </th>
        <th width="14%"> Tue </th>
        <th width="14%"> Wed </th>
        <th width="14%"> Thu </th>
        <th width="14%"> Fri </th>
        <th width="14%"> Sat </th>
        <th width="11%"> Sun </th-->
        <th tal:repeat="day view/weekcalendar">
            <b tal:content="python: view.getDay(day)" />
        </th>
      </tr>
    </thead>
    <tbody>
    <tr tal:define="week view/weekcalendar"> <!--tal:repeat="week view/monthcalendar" class="colapse-calender-row"-->
      <th tal:define="weekno python:view.getWeekNo(week[0])" tal:attributes="id string:calender-week-${weekno}"> <span tal:content="weekno"> 12</span>  </th>
      <td tal:repeat="day view/weekcalendar" tal:attributes="id python:view.getTdId(day)"> 
        <!--strong tal:content="python:day.day" tal:condition="day" tal:attributes="class python:view.getDayClass(day)"/>
        <br /-->
        <div tal:condition="day" style="position:relative; height:56em">
        <div tal:repeat="hour view/getDayHours"  tal:attributes="style python:view.getHourStyle(hour);">
           <span tal:content="string: ${hour}:00" class="hour-class"
                tal:attributes="onclick string:javascript:newSitting('$day', $hour);;"/>
        </div>
          <div tal:repeat="sitting python: view.getSittings4Day(day)" tal:attributes="style python:view.getEventStyle(sitting.start_date, sitting.end_date)" >
            <h4> <a tal:content="sitting/short_name" tal:attributes="href string:javascript:editSitting('${sitting/day}', '${sitting/start_time}', '${sitting/end_time}','${sitting/short_name}',${sitting/sid} );;" /> </h4>
            <ol tal:attributes="id sitting/sittingid; class string:draglist" tal:define="sid sitting/sid">
                <li tal:repeat="question python: view.getActiveSittingItems(sid)"                  
                 tal:attributes="id question/schedule_id; class question/schedule_date_class">
                 <a tal:content="question/subject" tal:attributes="title question/title; href question/url" />
                 </li>
            </ol>
            <ol tal:attributes="id sitting/sittingid; class string:inactive-list" tal:define="sid sitting/sid">
                <li tal:repeat="question python: view.getInactiveSittingItems(sid)" 
                 tal:content="question/subject"
                 tal:attributes="id question/schedule_id; title question/title" />
            </ol>
          </div>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
  <script type="text/javascript">
    <!--
(function() { 
 var xy =[0,0]
 function init() {
 
    // Define various event handlers for Dialog
    var handleSubmit = function() {
	    this.submit();
    };
    var handleCancel = function() {
	    this.cancel();
    };

   

   YAHOO.namespace("bungeni.container");        
    // Instantiate the Dialog
   YAHOO.bungeni.container.dialog = new YAHOO.widget.Dialog("addeditsittingdialog", 
			{ width : "300px",
			  fixedcenter : false,
			  visible : false, 
			  constraintoviewport : true,
			  modal : true,
			  underlay : "matte",
			  //iframe : true,
			  buttons : [ { text:"Submit", handler:handleSubmit, isDefault:true },
						  { text:"Cancel", handler:handleCancel } ]
			 } );

   var handleClick = function (e) {
        xy = YAHOO.util.Event.getXY(e);        
   } 
    
    
   YAHOO.util.Event.addListener(document, 'mousedown', handleClick ); 
   // Render the Dialog
    YAHOO.bungeni.container.dialog.render();
  }
       
    YAHOO.util.Event.onDOMReady(init);
            
    newSitting = function( sdate, stime) {        
        var Dom = YAHOO.util.Dom;
        var s_date = Dom.get("form_sitting_date");
        var s_time = Dom.get("form_sitting_start"); 
        var e_time = Dom.get("form_sitting_end");
        var e_title = Dom.get("form_sitting_title"); 
        var e_id = Dom.get("form_sitting_id");                      
        s_date.value = sdate;
        s_time.value = stime + ":00"
        e_time.value = stime + 2 + ":00"
        e_id.value = '';
        e_title.value = "";
        YAHOO.bungeni.container.dialog.moveTo(xy[0], xy[1]);  
        YAHOO.bungeni.container.dialog.show();         
    }
    
    // editSitting(${sitting/day}, ${sitting/start_time}, ${sitting/end_time},${sitting/short_name},${sitting/sid})
    
    editSitting = function ( sdate, stime, etime, title, id ) {
        var Dom = YAHOO.util.Dom;
        var s_date = Dom.get("form_sitting_date");
        var s_time = Dom.get("form_sitting_start"); 
        var e_time = Dom.get("form_sitting_end");
        var e_title = Dom.get("form_sitting_title"); 
        var e_id = Dom.get("form_sitting_id");                      
        s_date.value = sdate;
        s_time.value = stime;
        e_time.value = etime;
        e_id.value = id;
        e_title.value = title;  
        YAHOO.bungeni.container.dialog.moveTo(xy[0], xy[1]);  
        YAHOO.bungeni.container.dialog.show();                               
    }
    
})() 
    -->
  </script>
  
  <div id="addeditsittingdialog">
    <form action="@@ajax-add-or-edit-sitting" >
      <input type="hidden" value="" id="form_sitting_id" name="form_sitting_id" />
      <label for="form_sitting_type">Type:</label>      
      <select size="1" name="form_sitting_type" id="form_sitting_type" tal:define="sittingtypes view/sitting_types">
        <option tal:repeat="type sittingtypes" 
                tal:attributes="value type" 
                tal:content="python:sittingtypes[type]['type']">morning</option>
      </select> <br />
      <label for="form_sitting_title">Title:</label>
      <input type="textbox" id="form_sitting_title" name="form_sitting_title" value="" />   
      <br />      
      <label for="form_sitting_date">Date:</label>         
      <input type="textbox" id="form_sitting_date" name="form_sitting_date" readonly="readonly" value="1-1-00" />
      <br />
      <label for="form_sitting_start">Start:</label>               
      <input type="textbox" id="form_sitting_start" name="form_sitting_start" value="08:00" />
      <br />
      <label for="form_sitting_end">End:</label>               
      <input type="textbox" id="form_sitting_end" name="form_sitting_end" value="18:00" />     
    </form>
  </div>
</div>
    <!--div id = "bungeni-tabbed-nav" >
        <div tal:replace="structure provider:bungeni.schedule-items.manager" />
    </div-->  
    
