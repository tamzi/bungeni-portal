<!-- A section (or top-level) table-of-contents 
    (titles + description, nested list)
    
    Call this with 'section' defined 
  -->
<metal:block define-macro="section_tabs">
<div class="custom">
    <ul class="contentViews"  tal:condition="toc | nothing">
         <li  class="plain" tal:repeat="tocElement toc">
            <tal:item define="item tocElement/item">

            <a tal:attributes="href string:javascript:xmlhttpPost('${item/getURL}/referencemanualpage_simple')">
               <span  style="background-color:transparent;padding:0em 1em;" tal:attributes="class string:state-${item/review_state}" 
                     tal:content="item/Title" /></a>
            </tal:item>

         </li>
    </ul>
    <br/>
    <div id="pagecontents"></div>
</div>
</metal:block>

<metal:block define-macro="section_toc">
    <ul tal:condition="toc | nothing">
        <li tal:repeat="tocElement toc">
            <tal:item define="item tocElement/item">
                <span tal:content="python:tocElement['numbering']"></span>
                <a href="" tal:attributes="href item/getURL">
                <span tal:content="string:${item/Title}" tal:attributes="class string:state-${item/review_state}"/></a>
                    <tal:block define="toc tocElement/children">
                        <metal:recursion use-macro="here/referencemanual_macros/macros/section_toc"/>
                    </tal:block>
            </tal:item>
        </li>
    </ul>
</metal:block>

<metal:block define-macro="section_toc_roman">
    <ul tal:condition="toc | nothing">
        <li tal:repeat="tocElement toc">
            <tal:item define="item tocElement/item">
                <span tal:content="python:here.toRoman(tocElement['numbering'])"></span>
                <a href="" tal:attributes="href item/getURL">
                <span tal:content="string:${item/Title}" tal:attributes="class string:state-${item/review_state}"/></a>
                    <tal:block define="toc tocElement/children">
                        <metal:recursion use-macro="here/referencemanual_macros/macros/section_toc_roman"/>
                    </tal:block>
            </tal:item>
        </li>
    </ul>
</metal:block>

<metal:block define-macro="section_toc_alpha">
    <ul tal:condition="toc | nothing">
        <li tal:repeat="tocElement toc">
            <tal:item define="item tocElement/item">
                <span tal:content="python:here.toAlpha(tocElement['numbering'])"></span>
                <a href="" tal:attributes="href item/getURL">
                <span tal:content="string:${item/Title}" tal:attributes="class string:state-${item/review_state}"/></a>
                    <tal:block define="toc tocElement/children">
                        <metal:recursion use-macro="here/referencemanual_macros/macros/section_toc_alpha"/>
                    </tal:block>
            </tal:item>
        </li>
    </ul>
</metal:block>

<!-- Listing of all pages in a section

    Call this with toc (top level list, as returned by getTOC()) defined
  -->
<metal:block define-macro="section_collation">
    <tal:section repeat="section toc">
        <div tal:define="item      section/item;
                            itemObj   item/getObject;
                            itemUrl   itemObj/absolute_url;
                            body      itemObj/getBody | nothing;
                            numbering section/numbering;
                            itemDepth section/depth;
                            children  section/children;
                            addImagePaths nocall:context/addImagePaths | nothing;
                            "
            tal:attributes="class string:referenceManualCollation depth-${itemDepth}">

            <h1>
                <span tal:replace="numbering">1.</span>
                <span tal:replace="item/Title">Section Title</span>
            </h1>

            <div class="documentDescription" tal:content="item/Description">
                description
            </div>
    
            <div id="bodyContent" tal:condition="nocall:body">
                <tal:block condition="nocall:addImagePaths">
                    <div tal:replace="structure python:addImagePaths(body, itemUrl)" />
                </tal:block>
                <tal:block condition="not: nocall:addImagePaths">
                    <div tal:replace="structure body" />
                </tal:block>
            </div>

            <tal:subsections define="toc children"
                             condition="nocall:children">
                <metal:recursion use-macro="here/referencemanual_macros/macros/section_collation"/>
            </tal:subsections>

        </div>        
    </tal:section>
</metal:block>

<!-- The navigation bar

    Call this with tocInfo (as returned by getTOCInfo()) defined
  -->

<div metal:define-macro="navigation_bar"
    class="listingBar" 
    tal:define="nextIdx tocInfo/nextIdx;
                prevIdx tocInfo/prevIdx;
                tocList tocInfo/tocList"
    tal:condition="python: nextIdx!=None or prevIdx!=None"
    i18n:domain="plonehelpcenter">

    <tal:next condition="python:nextIdx!=None">
        
        <a class="listingNext"
           tal:define="next python:tocList[nextIdx]['item']" 
           tal:attributes="href next/getURL"
           tabindex="1"
           href="">
            <span i18n:translate="phc_next">
               Next:
            </span>
            <span tal:replace="python:tocList[nextIdx]['numbering']" />
            <span tal:replace="next/Title" /> 
           <img tal:replace="structure here/arrowRight.gif" />
       </a>   
    </tal:next>
       
    <tal:prev condition="python:prevIdx!=None">
        <a class="listingPrevious"
           tal:define="prev python:tocList[prevIdx]['item']" 
           tal:attributes="href prev/getURL"
           tabindex="1"
           href="">
            <img tal:replace="structure here/arrowLeft.gif" />
            <span i18n:translate="phc_previous">
               Previous:
            </span>
            <span tal:replace="python:tocList[prevIdx]['numbering']" />
            <span tal:replace="prev/Title" /> 
       </a>   
    </tal:prev>	       
	
    &nbsp;
</div>

<!-- The "jump to" drop-down box
    
    Call this with tocList (as returned in tocInfo returned by getTOCInfo())
    defined.
  -->
<div metal:define-macro="jump_box"
    class="jumpBox"
    i18n:domain="plonehelpcenter">

    <form method="get" action="#"
          tal:attributes="action context/absolute_url">
        <label for="destination" class="hiddenStructure">Jump to: </label>
        <select name=":action" tabindex="3"
                onchange="window.location.href=this.options[this.selectedIndex].value"
                tal:attributes="tabindex tabindex/next|nothing">
	    <option value="referencemanual-all-pages"
		    title="Useful for printing, presentation mode etc.">
	      All content on one page
	    </option>
            <option tal:repeat="tocItem tocList"
                    tal:attributes="value tocItem/item/getURL;
                                    selected python:tocItem['currentItem'] and 'selected' or nothing">
                <span tal:replace="tocItem/numbering"/>
                <span tal:replace="tocItem/item/Title"/>
            </option>
        </select>
        <noscript>
            <input class="standalone"
                   type="submit"
                   value="Go"
                   i18n:attributes="value"
                   tabindex="4"
                   tal:attributes="tabindex tabindex/next|nothing" />
        </noscript>
    </form>
</div>
