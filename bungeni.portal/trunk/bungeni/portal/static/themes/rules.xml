<?xml version="1.0" encoding="UTF-8"?>
<ruleset>
  <theme href="/static/themes/layout.html" />
  <match path="regex:.*/(private_folder|web_pages).*$"
 	 class="menu-items" />
  <match path="regex:.*/(private_folder|web_pages/).+$"
 	 class="menu-items" />      
  <match path="exact:/"
         class="frontpage" />
  <match path="exact:/front-page"
         class="frontpage" />
  <match path="regex:.*/calendar$"
 	 class="calendar-links" />
  <match path="regex:.*/presentation_view$"
 	 class="presentation-view" />
  <match path="regex:^/(members/current)/obj-([0-9])+(/)?(view)?$"
         class="member-links" />
  <match path="regex:^/business(/$|$)$"  class="load-whatson-navigation" />  
  <match path="regex:^(/business/.*|/business$)"  class="load-business-navigation" />
  <match path="/members/"  class="load-member-navigation" />
  <match path="/archive/"  class="load-archive-navigation" />
  <match path="/admin/"  class="load-admin-navigation" />  
  <match path="regex:^/(business|members|archive|admin|workspace)/?"
         class="bungeni" />
  <match path="/calendar/"  class="load-calendar-navigation" />
  <match path="/workspace"  class="load-workspace-navigation" />
  <match path="/workspace-archive"  class="load-workspace-navigation" />        
  <match path="regex:.*/audit-log$"
 	 class="bungeni-header" />
  <match path="regex:.*/(emptypage)$"
 	 abort="1" />
  <match path="/"
         class="primary" />
  
  
  <rule class="workspace-committee">
    <!-- content -->
    <append content="h2"
            theme=".main-content" />
    <append content="dl.enableFormTabbing > dt"
            theme="children:dl.enableFormTabbing" />
    <append content="dl.enableFormTabbing > dd"
            theme="children:dl.enableFormTabbing" />
    <replace content="children:.documentContent"
             theme="children:#fieldset-display-form-workspace > div" />    
    <pyquery pyref="bungeni.portal/static/themes/rules:add_workspace"
             pyarg-workspace_id="#workgroup-id"/>
  </rule>
  
  <rule class="workspace-member">
    <!-- content -->
    <pyquery pyref="bungeni.portal/static/themes/rules:add_workspace_link"
             pyarg-workspace_id="#user-workspace-id"/>
  </rule>
  
  <rule class="load-whatson-navigation">
    <drop content="#portal-column-one" />
    <drop content="//head" />    
    <prepend href="/business/whats-on"
             theme="//head"
             content="//head" />             
    <prepend href="/business/whats-on"    
             content="#viewlet-above-content"
             theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:add_ArchiveDates"
             pyarg-portlet_id="#viewlet-above-content"/>    
  </rule>      
  
  <rule class="load-business-navigation">
    <append href="/plone/business"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <append href="/plone/business"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />
    <pyquery pyref="bungeni.portal/static/themes/rules:rewrite_links" />
    <drop content="ul#portal-personaltools > li:nth-child(7)" />
  </rule>
  
  <rule class="load-member-navigation">
    <append href="/plone/members"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <append href="/plone/members"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />    
  </rule>
  
  
  <rule class="load-archive-navigation">
    <append href="/plone/archive"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <append href="/plone/archive"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />
    <pyquery pyref="bungeni.portal/static/themes/rules:rewrite_links" />    
  </rule>
  
  <rule class="load-admin-navigation">
    <append href="/plone"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <append href="/plone/archive"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />
    <pyquery pyref="bungeni.portal/static/themes/rules:rewrite_links" />    
  </rule>     
  
  <rule class="bungeni">
    
    <!-- site actions -->
    <replace href="/plone/"
             content="#portal-siteactions"
             theme="#portal-siteactions" />      
    
    <!-- searchbox -->
    <replace href="/plone/"
             content="#portal-searchbox"
             theme="#portal-searchbox" />    
    <!-- menu -->
    <append content="ul#portal-personaltools li.navigation"
            theme="children:#portal-globalnav ul.level1"
            if-content=".navigation" />    
    <drop content="#portal-globalnav" />
    
    <!-- left portlet -->
    <replace content="#portal-column-one"
             theme="#portal-column-one" />
    <pyquery pyref="bungeni.portal/static/themes/rules:drop_workspace" />
    <!-- content -->
    <prepend content="children:#portal-column-content"
             theme="children:#portal-column-content" />
    <append content="#kss-spinner"
            theme="#portal-columns" />
  </rule>
  
  <rule class="load-calendar-navigation">
    
    <!-- site actions -->
    <replace href="/plone/"
             content="#portal-siteactions"
             theme="#portal-siteactions" />     
    <!-- searchbox -->
    <replace href="/plone/"
             content="#portal-searchbox"
             theme="#portal-searchbox" />
    <drop content="#portal-personaltools"/>    
    <append href="/plone/"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <replace href="/bungeni/calendar"
             content="ul#portal-personaltools li.navigation"
             theme="children:#portal-globalnav ul.level1" />
    <pyquery pyref="bungeni.portal/static/themes/rules:add_member_workspace_links"
             pyarg-link_id="#user-workspace-id"/>        
    <drop content="#portal-globalnav"/>
    <replace content="#portal-column-one"
             theme="#portal-column-one"/>    
    <append content="children:#portal-column-content"
            theme="children:#portal-column-content" />
    <append href="/plone/calendar"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />
    <pyquery pyref="bungeni.portal/static/themes/rules:rewrite_links" />    
    <append content="#kss-spinner"
            theme="#portal-columns" />    
  </rule>

  
  <rule class="load-workspace-navigation">
    <!-- site actions -->
    <replace href="/plone/"
             content="#portal-siteactions"
             theme="#portal-siteactions" />     
    <!-- searchbox -->
    <replace href="/plone/"
             content="#portal-searchbox"
             theme="#portal-searchbox" />
    <prepend content="#portal-globalnav > li:first-child"
             theme="children:#portal-globalnav > ul" />
    <append href="/plone/"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <!--drop content="#portal-globalnav"/-->
    
    <pyquery pyref="bungeni.portal/static/themes/rules:add_member_workspace_links"
             pyarg-link_id="#user-workspace-id"/>                
    <replace content="#portal-column-one"
             theme="#portal-column-one"/>    
    <append content="children:#portal-column-content"
            theme="children:#portal-column-content" />
    <append href="/plone/workspace-archive"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />
    <append content="#kss-spinner"
            theme="#portal-columns" />    
  </rule>  

  <rule class="calendar-links">
    <pyquery pyref="bungeni.portal/static/themes/rules:nextprev_links" />    
   </rule>

  <rule class="member-links">
    <pyquery pyref="bungeni.portal/static/themes/rules:image_links" />    
   </rule>  

  <rule class="presentation-view">
    <!--body-->
    <replace content="body"
             theme="body" />    
   </rule>

  
  <rule class="menu-items">
    <drop content="#portal-globalnav > li:first-child"/>             
    <append content="#portal-globalnav > li"
             theme="children:#portal-globalnav > ul" />

    <replace href="/bungeni"
            content="ul#portal-personaltools li.navigation"
            theme="children:#portal-globalnav ul.level1" />
    <pyquery pyref="bungeni.portal/static/themes/rules:add_member_workspace_links"
             pyarg-link_id="#portal-breadcrumbs"/>
    <pyquery pyref="bungeni.portal/static/themes/rules:add_member_workspace_styles" />
    <drop content="ul#portal-personaltools" />    
    <append content="#viewlet-above-content"
             theme="children:.main-content"/>     
  </rule>
  
  <rule class="frontpage">
    <!--header-->
    <prepend href="/workspace"
             theme="//head"
             content="//head"/>         
    <replace content="#portal-logo" theme="#portal-logo" />
    <replace content="#portal-siteactions" theme="#portal-siteactions" />    
    <replace content="#portal-searchbox" theme="#portal-searchbox" />
    
    <!-- menu -->
    <append content="#portal-globalnav > li:first-child"
            theme="children:#portal-globalnav > ul.level1" />    
    <append href="/workspace"
            content="#portal-globalnav > li:first-child"
            theme="children:#portal-globalnav > ul" />
    <append content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />    
    <prepend href="/workspace"
             content=".contentActions"
             theme="children:.main-content" />
    <append href="/workspace"
            content="#viewlet-above-content"
             theme="children:.main-content" />
    <replace content="#portal-personaltools" theme="#portal-personaltools" />
    <append href="/workspace"
            content="ul#portal-personaltools li.navigation"
            theme="children:#portal-globalnav ul.level1" />
    <pyquery pyref="bungeni.portal/static/themes/rules:add_member_workspace_links"
             pyarg-link_id="#user-workspace-id"/>    
    <!-- breadcrumbs -->
    <replace content="#portal-breadcrumbs" theme="#portal-breadcrumbs" />

    <!-- content -->
    <prepend href="/workspace"
            content="elements:#bungeni-workspace"
            theme="children:#bungeni-workspace" />
    <append content=".portletWorkflowReview"
            theme="children:#review-portlet" />
    <append content=".documentActions"
            theme="children:#portal-column-content" />                        
    <!-- right portlet -->
    <prepend href="/business/"
             content="children:#region-content"
             theme="children:#portal-column-two"/>    
    <prepend href="/workspace/"
             content="#workspace-viewlet-my_groups"
             theme="children:#portal-column-two" />
    <append content="children:#portal-column-two" theme="children:#portal-column-two" />
    
    <!-- body attributes -->
    <append content="attributes(class):body"
            theme="attributes:body" />
    <replace content="attributes(class):body"
            theme="attributes:dl.enableFormTabbing" />            
    <append href="/workspace/"
            content="attributes:div#bungeni-workspace"
            theme="attributes:body" />
    <pyquery pyref="bungeni.portal/static/themes/rules:move_portlet" />
    <pyquery pyref="bungeni.portal/static/themes/rules:drop_whatsonLinks" />        
  </rule>  

  <rule class="bungeni-header">
    <!--header-->
    <prepend href="/bungeni"
            theme="//head"
            content="//head" />    
   </rule>

 
  <rule class="primary">
    <drop theme=".workspace-tab"
          if-content="not:a[href*='committees/obj-'], a[href*='members/current/obj-']"/>     
    <append theme="//head" content="//head/meta" nocontent="ignore" />     
    <!-- header -->
    <replace content="#portal-logo" theme="#portal-logo" />
    <replace content="#portal-searchbox" theme="#portal-searchbox" />

    <!-- menu -->
    <prepend href="/bungeni"
             content="#portal-globalnav > li:first-child"
             theme="children:#portal-globalnav > ul" />
    <prepend href="/workspace"
             content="#portal-globalnav > li:first-child"
             theme="children:#portal-globalnav > ul" />    
    <drop content="#portal-globalnav > li:first-child"/>
    <append content="#portal-globalnav > li"
             theme="children:#portal-globalnav > ul" />
    <prepend content="ul#portal-personaltools li.navigation"
            theme="children:#portal-globalnav ul.level1"
            if-content=".navigation" />    
    <append href="/plone"
            content="children:#portal-personaltools :not(.navigation)"
            theme="children:#portal-personaltools" />            

    <!-- breadcrumbs -->
    <drop content="#breadcrumbs-you-are-here"/>    
    <drop content="#portal-breadcrumbs > a"/>
    <append content="children:#portal-breadcrumbs" theme="children:#portal-breadcrumbs" />
    <prepend href="/plone"
             content="#portal-breadcrumbs > a"
             theme="children:#portal-breadcrumbs" />
    <prepend href="/plone"
             content="#breadcrumbs-you-are-here"
             theme="children:#portal-breadcrumbs" />    
    <!-- content -->
    <append content="children:#portal-column-content" theme="children:.main-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:drop_contentActions" />
    <pyquery pyref="bungeni.portal/static/themes/rules:rewrite_links" />    
    <!-- body attributes -->
    <append content="attributes:body" theme="attributes:body" />
    <pyquery pyref="bungeni.portal/static/themes/rules:modify_siteactions" />        
    <pyquery pyref="bungeni.portal/static/themes/rules:drop_tabLinks" />    
    <pyquery pyref="bungeni.portal/static/themes/rules:add_section_links"/>
    
   </rule>

</ruleset>
