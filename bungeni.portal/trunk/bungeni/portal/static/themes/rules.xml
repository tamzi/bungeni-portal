<?xml version="1.0" encoding="UTF-8"?>
<ruleset>
  <theme href="/static/themes/layout.html" />
  <match path="exact:/"
         class="frontpage" />
  <match path="exact:/front-page"
         class="frontpage" />
  <match path="regex:^/(business/committees|archive/browse/committees)/obj-([0-9])+(/)?(view)?$"
 	 class="workspace-committee" />  
  <match path="regex:^/(archive/browse/parliaments)/obj-([0-9])/committees/+obj-([0-9])+(/)?(view)?$"
 	 class="workspace-committee" />    
  <match path="regex:^/(members/current)/obj-([0-9])+(/)?(view)?$"
         class="workspace-member" />
  <match path="/business/"  class="load-business-navigation" />
  <match path="/members/"  class="load-member-navigation" />
  <match path="/archive/"  class="load-archive-navigation" />
  <match path="regex:^/(business|members|archive)/?"
         class="bungeni" />
                                                                   
  <match path="/calendar/"  class="load-calendar-navigation" />
  <match path="/dspace/"  class="load-dspace-navigation" />
  <match path="/"
         class="primary" />
  
  <rule class="workspace-committee">
    <!-- content -->
    <prepend content="#portletArchiveDates"
             theme=".main-content" />
    <prepend content="dl.enableFormTabbing > dt"
             theme="children:dl.enableFormTabbing" />
    <prepend content="dl.enableFormTabbing > dd"
             theme="children:dl.enableFormTabbing" />
    <replace content="children:.documentContent"
             theme="children:#fieldset-display-form-workspace > div" />
    <pyquery pyref="bungeni.portal/static/themes/rules:add_workspace"
             pyarg-workspace_id="#workgroup-id"/>
   </rule>

  <rule class="workspace-member">
    <!-- content -->
    <prepend content="dl.enableFormTabbing > dt"
             theme="children:dl.enableFormTabbing" />
    <prepend content="dl.enableFormTabbing > dd"
             theme="children:dl.enableFormTabbing" />
    <replace content="children:.documentContent"
             theme="children:#fieldset-display-form-workspace > div" />
    <pyquery pyref="bungeni.portal/static/themes/rules:add_workspace"
             pyarg-workspace_id="#user-workspace-id"/>
   </rule>
  
  <rule class="load-business-navigation">
    <append href="/plone/business"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <append href="/plone/business"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />    

  </rule>
    
  <rule class="load-member-navigation">
    <append href="/plone/members"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <append href="/plone/members"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />    
  </rule>
  
  <rule class="load-archive-navigation">
    <append href="/plone"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <append href="/plone/archive"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />    
  </rule>   

  <rule class="bungeni">
    
    <!-- searchbox -->
    <replace href="/plone/"
             content="#portal-searchbox"
             theme="#portal-searchbox" />    
    <!-- menu -->
    <append content="ul#portal-personaltools li.navigation"
            theme="children:#portal-globalnav ul.level1"
            if-content=".navigation" />    
    <drop content="#portal-globalnav" />
 
    <!-- left portlet -->
    <replace content="#portal-column-one"
            theme="#portal-column-one" />
    <pyquery pyref="bungeni.portal/static/themes/rules:drop_workspace" />
    <!-- content -->
    <prepend content="children:#portal-column-content"
             theme="children:#portal-column-content" />
   </rule>

  <rule class="load-calendar-navigation">
    <!-- searchbox -->
    <replace href="/plone/"
             content="#portal-searchbox"
             theme="#portal-searchbox" />
    
    <append href="/plone/"
            content="#portal-globalnav > li:not(:first-child)"
            theme="children:#portal-globalnav > ul" />
    <replace href="/bungeni/calendar"
            content="ul#portal-personaltools li.navigation"
            theme="children:#portal-globalnav ul.level1" />    
    <drop content="#portal-globalnav"/>
    <replace content="#portal-column-one"
             theme="#portal-column-one"/>    
    <append content="children:#portal-column-content"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:rewrite_links" />
    <append href="/plone/calendar"
            content=".documentActions"
            theme="children:#portal-column-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:documentActions_links" />
   </rule>
  
  

  <rule class="frontpage">
    <!-- header-->
    <replace content="#portal-logo" theme="#portal-logo" />
    <replace content="#portal-searchbox" theme="#portal-searchbox" />

    <!-- menu -->
    <drop href="/plone"
          content="#portal-globalnav > li:first-child"/>     
    <append href="/bungeni"
             content="#portal-globalnav > li:first-child"
             theme="children:#portal-globalnav > ul" />
    <append content="#portal-globalnav > li"
             theme="children:#portal-globalnav > ul" />
    <prepend href="/bungeni"
             content=".contentActions"
             theme="children:.main-content"/>            
    <replace content="#portal-personaltools" theme="#portal-personaltools" />
    <append href="/bungeni"
            content="ul#portal-personaltools li.navigation"
            theme="children:#portal-globalnav ul.level1" />

    <!-- breadcrumbs -->
    <replace content="#portal-breadcrumbs" theme="#portal-breadcrumbs" />

    <!-- content -->
    <prepend href="/bungeni/"
            content="elements:#bungeni-workspace" theme="children:#bungeni-workspace"/>
    <append content=".portletWorkflowReview"
            theme="children:#review-portlet" />
    <append content=".documentActions"
            theme="children:#portal-column-content" />                        


    <!-- right portlet -->
    <prepend href="/business/"
             content="children:#region-content"
             theme="children:#portal-column-two"/>
    <append content="children:#portal-column-two" theme="children:#portal-column-two" />
    
    <!-- body attributes -->
    <append content="attributes(class):body"
            theme="attributes:body" />
    <replace content="attributes(class):body"
            theme="attributes:dl.enableFormTabbing" />            
    <append href="/bungeni/"
            content="attributes:div#bungeni-workspace"
            theme="attributes:body" />    
    <pyquery pyref="bungeni.portal/static/themes/rules:move_portlet" />    

  </rule>  

  <rule class="load-dspace-navigation">
    <replace content=".navigationBar"
             theme="#portal-column-one" />
    <replace content="children:.pageContents"
             theme="children:#portal-column-content" />            
  </rule>

  <rule class="primary">
    <drop theme=".workspace-tab"
          if-content="not:a[href*='committees/obj-'], a[href*='members/current/obj-']"/>
    
    <prepend href="/bungeni"
            theme="//head"
            content="//head" />     
    <append theme="//head" content="//head/meta" nocontent="ignore" />     
    <!-- header -->
    <replace content="#portal-logo" theme="#portal-logo" />
    <replace content="#portal-searchbox" theme="#portal-searchbox" />

    <!-- menu -->
    <prepend href="/bungeni"
             content="#portal-globalnav > li:first-child"
             theme="children:#portal-globalnav > ul" />
    <drop content="#portal-globalnav > li:first-child"/>
    <append content="#portal-globalnav > li"
             theme="children:#portal-globalnav > ul" />
    <append content="ul#portal-personaltools li.navigation"
            theme="children:#portal-globalnav ul.level1"
            if-content=".navigation" />    
    <append href="/plone"
            content="children:#portal-personaltools :not(.navigation)"
            theme="children:#portal-personaltools" />            

    <!-- breadcrumbs -->
    <drop content="#breadcrumbs-you-are-here"/>    
    <drop content="#portal-breadcrumbs > a"/>
    <append content="children:#portal-breadcrumbs" theme="children:#portal-breadcrumbs" />
    <prepend href="/plone"
             content="#portal-breadcrumbs > a"
             theme="children:#portal-breadcrumbs" />
    <prepend href="/plone"
             content="#breadcrumbs-you-are-here"
             theme="children:#portal-breadcrumbs" />    
    <!-- content -->
    <append content="children:#portal-column-content" theme="children:.main-content" />
    <pyquery pyref="bungeni.portal/static/themes/rules:rewrite_links" />
    <pyquery pyref="bungeni.portal/static/themes/rules:drop_contentActions" />
    <!-- body attributes -->
    <append content="attributes:body" theme="attributes:body" />
    
   </rule>
</ruleset>
