some setup for tests

   >>> from zope import component
   >>> from sqlalchemy import create_engine
   >>> from ore.alchemist.interfaces import IDatabaseEngine
   >>> from ore.alchemist import Session
   >>> from bungeni import models as model
   >>> from bungeni.models import domain, schema
   >>> from bungeni.core.workflows import dbutils
   >>> import datetime
   >>> import bungeni.core.workflows.question as question_workflow
   >>> import bungeni.core.workflows.transitioncron as cron
   >>> import bungeni.core.workflows.question
   >>> import ore.workflow   
   
Setting up Database Connection and Utilities:
   >>> import bungeni.core.testing as testing
   >>> testing.setup_db()  
   >>> import bungeni.core.workflows.testing
   >>> bungeni.core.workflows.testing.setup_adapters()
   >>> bungeni.core.workflows.testing.setup_security_adapters()
   >>> session = Session()
   


   
Questions

  >>> question = domain.Question()
  >>> question.approval_date = datetime.date.today() - datetime.timedelta(5)
  >>> question.status ="questionstates.admissible"  
  >>> session.add(question)
  >>> session.flush()
  
  >>> question.question_id
  1L
  
  >>> question2 = domain.Question()
  >>> question2.approval_date = datetime.date.today() - datetime.timedelta(1)
  >>> question2.status = "questionstates.admissible"  
  >>> session.add(question2)
  >>> session.flush()
  
    
  >>> question3 = domain.Question()
  >>> question3.approval_date = datetime.date.today() - datetime.timedelta(1)
  >>> question3.status = "questionstates.complete"  
  >>> session.add(question3)
  >>> session.flush()
  
get the questions that are in the workflow state:
  
  >>> questions = cron._getQuestionsApprovedBefore(datetime.date.today(), "questionstates.admissible")  
  >>> len(questions)
  2
  
  >>> questions = cron._getQuestionsApprovedBefore(datetime.date.today(), "questionstates.complete")  
  >>> len(questions)  
  1  
    
defer admissible question older than today

  >>> cron._deferAdmissibleQuestionsBefore(datetime.date.today()) 
  >>> session.flush()     
 
  >>> questions = cron._getQuestionsApprovedBefore(datetime.date.today(), "questionstates.admissible")  
  >>> len(questions)
  0
  
  >>> questions = cron._getQuestionsApprovedBefore(datetime.date.today(), "questionstates.complete")  
  >>> len(questions)  
  1      

  >>> questions = cron._getQuestionsApprovedBefore(datetime.date.today(), "questionstates.deferred")  
  >>> len(questions)  
  2        
  
cleanup
-------
  >>> session.flush()
  >>> session.commit()
  >>> session.close()
  
